import{r as i,j as e,a as ue}from"./react-IG33nVQy.js";import{R as he}from"./react-dom-CKDujJrI.js";import{a as be}from"./axios-Dq7h7Pqt.js";import{u as Z,a as pe,P as ye}from"./react-redux-kWBb2qPE.js";import{c as G,a as fe}from"./@reduxjs-BxHbOFo4.js";import{u as U,L as W,a as Y,b as Q,N as ke,B as je,R as we,c as P}from"./react-router-BM2Je1_T.js";import{F as z,f as q,a as Ne}from"./@fortawesome-BZBrv1fz.js";import{S as V}from"./react-select-2BF7SFX-.js";import{C as ve}from"./react-color-DbVKCiwJ.js";import"./tinycolor2-Begke6kS.js";import Se from"./html2canvas-CBrSDip1.js";import{E as Ce}from"./jspdf-xDGuz2RE.js";import{F as K}from"./file-saver-DeVphGqM.js";import{S as De,P as Ae,R as Fe,D as Le,a as Re,L as Ue,B as X}from"./react-chartjs-2-DKvYy1IB.js";import{C as Ie,b as Pe,c as $e,d as Ee,e as ze,A as Oe,f as Me,g as _e,p as qe,h as Be,i as Te}from"./chart.js-Bdm0kU0e.js";import{P as v}from"./prop-types-ObWv-nO2.js";import{P as ee}from"./react-plotly.js-DI_vu6It.js";import{P as te}from"./plotly.js-dist-min-BOOp0u13.js";import{F as He,a as Ve,b as Ke,M as Je,c as ae,d as Ze,e as Ge,f as We,g as Ye,h as Qe,i as J,j as Xe,k as et,l as tt}from"./react-icons-wHFhQc3A.js";import{m as C}from"./framer-motion-5LAronI4.js";import"./@icons-BYHlBSbu.js";import"./scheduler-SPyfQU6S.js";import"./use-sync-external-store-BHWXpT6-.js";import"./redux-BXkGT1VS.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./cookie--_YQFYBD.js";import"./@babel-ke9bJKh4.js";import"./@emotion-_DnjY_Oe.js";import"./hoist-non-react-statics-C48UpQYE.js";import"./react-is-CnyDuYXe.js";import"./stylis-DDa9OTMq.js";import"./@floating-ui-C62H77Fa.js";import"./use-isomorphic-layout-effect-C41AkXHD.js";import"./memoize-one-BdPwpGay.js";import"./reactcss-W-LcCq8q.js";import"./lodash-BKJqgg__.js";import"./lodash-es-DN0AVw_E.js";import"./material-colors-7R66pBqW.js";import"./fflate-BO5HMHBV.js";import"./@kurkle-D8fDXNIl.js";import"./plotly.js-CTZZYd3D.js";import"./motion-dom-CNks1Gr0.js";import"./motion-utils-CjIqCkNq.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const x of s.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&o(x)}).observe(document,{childList:!0,subtree:!0});function a(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=a(l);fetch(l.href,s)}})();const w=be.create({baseURL:"http://localhost:5000/api"});w.interceptors.request.use(t=>{const r=localStorage.getItem("token");return r&&(t.headers.Authorization=`Bearer ${r}`),t});const at={user:null,token:localStorage.getItem("token")||null},re=G({name:"auth",initialState:at,reducers:{setCredentials:(t,r)=>{const{user:a,token:o}=r.payload;t.user=a,t.token=o,localStorage.setItem("token",o)},logout:t=>{t.user=null,t.token=null,localStorage.removeItem("token")}}}),{setCredentials:se,logout:ba}=re.actions,rt=re.reducer,oe=()=>!!localStorage.getItem("token"),st=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},ot=(t,r)=>{localStorage.setItem("token",t),localStorage.setItem("user",JSON.stringify(r))},lt=()=>{try{const t=localStorage.getItem("user");return t&&t!=="undefined"?JSON.parse(t):null}catch{return null}},nt=()=>{const[t,r]=i.useState({email:"",password:""}),[a,o]=i.useState(!1),l=Z(),s=U(),x=n=>{r({...t,[n.target.name]:n.target.value})},p=async n=>{var m,d;if(n.preventDefault(),!t.email||!t.password){alert("Please enter both email and password.");return}try{o(!0);const c=await w.post("/auth/login",t),{token:g,...u}=c.data;localStorage.setItem("token",g),localStorage.setItem("user",JSON.stringify(u)),ot(g,u),l(se(c.data)),s("/")}catch(c){console.error("Login failed:",c),alert(((d=(m=c==null?void 0:c.response)==null?void 0:m.data)==null?void 0:d.message)||"Invalid credentials or server error.")}finally{o(!1)}};return e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 transition-all duration-500",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/80 dark:bg-gray-800/80 border border-gray-200 dark:border-gray-700 shadow-2xl rounded-xl p-8 w-full max-w-md transition-all duration-500",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-gray-800 dark:text-white",children:"🔐 Login"}),e.jsxs("form",{onSubmit:p,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{name:"email",type:"email",value:t.email,onChange:x,required:!0,placeholder:"Enter your email",className:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{name:"password",type:"password",value:t.password,onChange:x,required:!0,placeholder:"Enter your password",className:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"})]}),e.jsx("button",{type:"submit",disabled:a,className:"w-full py-2 px-4 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold shadow-md hover:shadow-lg transition-all duration-300",children:a?"Logging in...":"Login"})]}),e.jsxs("div",{className:"text-center mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Don’t have an account?"}),e.jsx(W,{to:"/register",className:"mt-2 inline-block text-blue-600 dark:text-blue-400 hover:underline transition-all",children:"➕ Register Now"})]})]})})},dt=()=>{const[t,r]=i.useState({name:"",email:"",password:"",role:"user",adminSecretKey:""}),[a,o]=i.useState(!1),l=Z(),s=U(),x=n=>{const{name:m,value:d}=n.target;r(c=>({...c,[m]:d}))},p=async n=>{var c,g;n.preventDefault(),o(!0);const m=t.role==="admin",d={name:t.name,email:t.email,password:t.password,isAdmin:m,adminSecretKey:m?t.adminSecretKey:void 0};try{const u=await w.post("/auth/register",d);l(se(u.data)),localStorage.setItem("token",u.data.token),localStorage.setItem("user",JSON.stringify(u.data)),u.data.isAdmin?s("/admin/dashboard"):s("/")}catch(u){alert(((g=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:g.message)||"Registration failed")}finally{o(!1)}};return e.jsxs("div",{className:"max-w-md mx-auto mt-12 px-6 py-8 bg-white dark:bg-gray-800 shadow-xl rounded-2xl transition-all duration-500",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-gray-800 dark:text-white",children:"📝 Create Account"}),e.jsxs("form",{onSubmit:p,className:"space-y-5",children:[e.jsx("input",{name:"name",value:t.name,onChange:x,required:!0,placeholder:"Full Name",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-600 transition"}),e.jsx("input",{name:"email",type:"email",value:t.email,onChange:x,required:!0,placeholder:"Email",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-600 transition"}),e.jsx("input",{name:"password",type:"password",value:t.password,onChange:x,required:!0,placeholder:"Password",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-600 transition"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Role"}),e.jsxs("select",{name:"role",value:t.role,onChange:x,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-600 transition",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),t.role==="admin"&&e.jsx("input",{name:"adminSecretKey",type:"text",value:t.adminSecretKey,onChange:x,placeholder:"Admin Secret Key",required:!0,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-600 transition"}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transform hover:scale-[1.02] transition-all duration-300",disabled:a,children:a?"Registering...":"Register"})]})]})},it=()=>{const[t,r]=i.useState([]),[a,o]=i.useState(null),[l,s]=i.useState("newest"),[x,p]=i.useState(null),[n,m]=i.useState(!1),d=localStorage.getItem("token"),c=U();i.useEffect(()=>{d||c("/login")},[d,c]),i.useEffect(()=>{g(),u()},[]);const g=async()=>{try{const h=await w.get("/auth/me");p(h.data)}catch(h){console.error("Failed to load user",h),c("/login")}},u=async()=>{try{const h=await w.get("/upload/history");r(h.data)}catch(h){console.error(h)}},y=h=>o(h.target.files[0]),k=async h=>{var N,D;if(h.preventDefault(),!a)return alert("Please select a file");const S=new FormData;S.append("file",a),m(!0);try{await w.post("/upload",S),u(),o(null),alert("✅ File uploaded!")}catch(A){console.error("Upload failed",A),alert(((D=(N=A.response)==null?void 0:N.data)==null?void 0:D.message)||"Upload failed")}finally{m(!1)}},F=async h=>{if(window.confirm("Are you sure you want to delete this file?"))try{await w.delete(`/upload/${h}`),r(S=>S.filter(N=>N._id!==h))}catch(S){console.error("Delete failed",S),alert("Failed to delete file.")}},L=async(h,S)=>{try{const N=await w.get(`/upload/download/${h}`,{responseType:"blob"}),D=window.URL.createObjectURL(new Blob([N.data])),A=document.createElement("a");A.href=D,A.setAttribute("download",S||"download.xlsx"),document.body.appendChild(A),A.click()}catch(N){console.error("Download failed",N)}},$=[...t].sort((h,S)=>l==="newest"?new Date(S.createdAt)-new Date(h.createdAt):new Date(h.createdAt)-new Date(S.createdAt));return e.jsxs("div",{className:"max-w-7xl mx-auto mt-10 p-6 dark:bg-gray-900 min-h-screen transition-all duration-500",children:[e.jsxs("h1",{className:"text-4xl font-extrabold mb-6 text-center text-gray-800 dark:text-gray-100",children:["Welcome,"," ",e.jsx("span",{className:"bg-gradient-to-r from-blue-500 to-cyan-400 bg-clip-text text-transparent",children:(x==null?void 0:x.name)||"User"})," ","👋"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mb-8 flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:y,className:"file-input file-input-bordered file-input-sm dark:bg-gray-800 dark:border-gray-700 dark:text-white w-full sm:w-auto"}),e.jsx("button",{type:"button",onClick:k,disabled:n,className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-2 rounded-lg shadow-md hover:shadow-lg transition-all duration-300",children:n?"Uploading...":"📤 Upload Excel"})]}),e.jsxs("div",{className:"mb-6 flex justify-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Sort by:"}),e.jsxs("select",{value:l,onChange:h=>s(h.target.value),className:"select select-bordered select-sm dark:bg-gray-800 dark:border-gray-700 dark:text-white",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),t.length===0?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No uploads yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:$.map(h=>e.jsxs("div",{className:"p-5 rounded-xl shadow-lg bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 flex flex-col justify-between relative",children:[e.jsx("span",{className:"absolute top-3 right-3 px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",children:"XLSX"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold break-all text-gray-800 dark:text-white",children:h.fileName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Uploaded on ",new Date(h.createdAt).toLocaleString()]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>c(`/analyze/${h._id}`),className:"bg-blue-500 hover:bg-blue-600 text-white py-1.5 px-4 rounded-lg text-sm shadow-md hover:shadow-lg transition-all",children:"📊 Analyze"}),e.jsx("button",{onClick:()=>L(h._id,h.fileName),className:"bg-green-500 hover:bg-green-600 text-white py-1.5 px-4 rounded-lg text-sm shadow-md hover:shadow-lg transition-all",children:"⬇️ Download"}),e.jsx("button",{onClick:()=>F(h._id),className:"bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-lg text-sm shadow-md hover:shadow-lg transition-all",title:"Delete",children:e.jsx(z,{icon:q})})]})]},h._id))})]})},ct=({fileId:t,onSummaryGenerated:r})=>{const[a,o]=i.useState(""),[l,s]=i.useState(!1),[x,p]=i.useState(""),n=d=>d.replace(/\*\*(.*?)\*\*/g,"$1"),m=async()=>{var d,c;s(!0),p(""),o("");try{const g=await w.post(`/upload/${t}/ai-summary`);if(g.data&&g.data.summary){const u=n(g.data.summary);o(u),r&&r(u)}else p("No summary returned.")}catch(g){console.error(g),p(((c=(d=g.response)==null?void 0:d.data)==null?void 0:c.message)||"AI summary failed.")}finally{s(!1)}};return e.jsxs("div",{className:"mt-8 p-6 rounded-xl shadow-md bg-white dark:bg-gray-800 transition-all duration-500",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100",children:"🤖 AI Summary"}),e.jsx("button",{onClick:m,disabled:l,className:`w-full py-3 px-5 rounded-lg text-white font-semibold transition-all duration-300
          ${l?"bg-gray-500 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-md hover:shadow-lg transform hover:scale-[1.02]"}`,children:l?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Generating..."]}):"Generate Summary"}),x&&e.jsxs("div",{className:"mt-5 p-4 bg-red-100 dark:bg-red-800 text-red-800 dark:text-red-200 rounded-lg shadow",children:[e.jsx("p",{children:x}),e.jsx("button",{onClick:m,className:"mt-3 inline-block text-blue-600 dark:text-blue-300 hover:underline text-sm",children:"🔄 Retry"})]}),a&&e.jsx("div",{className:"mt-6 p-5 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-inner text-gray-800 dark:text-gray-100 whitespace-pre-wrap leading-relaxed",children:a})]})},gt=t=>{const r=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f43f5e","#eab308","#6366f1","#06b6d4","#d946ef","#84cc16","#f97316","#0ea5e9","#a855f7","#22d3ee","#e11d48"],a=r.length;if(t<=a)return r.slice(0,t);const o=[];for(let l=0;l<t;l++){const s=r[l%a],x=1-Math.floor(l/a)*.1;o.push(mt(s,Math.max(x,.4)))}return o},mt=(t,r=1)=>{const a=parseInt(t.replace("#",""),16),o=a>>16&255,l=a>>8&255,s=a&255;return`rgba(${o}, ${l}, ${s}, ${r})`};Ie.register(Pe,$e,Ee,ze,Oe,Me,_e,qe,Be,Te);const xt={bar:X,line:Ue,pie:Re,doughnut:Le,radar:Fe,polarArea:Ae,scatter:De},le=({chartType:t,dataRows:r,selectedX:a,selectedY:o,color:l,chartRef:s})=>{if(!a||!o||r.length===0)return e.jsx("div",{className:"text-center py-8 bg-white/80 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700 rounded-xl shadow-inner",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400 animate-pulse",children:"📊 Select fields to generate a chart"})});const x=xt[t];if(!x)return e.jsx("p",{className:"text-red-500 bg-red-100 dark:bg-red-900/30 p-3 rounded-lg text-center",children:"❌ Chart type not supported."});const p=["pie","doughnut","polarArea"],n=t==="scatter",m=r.map(k=>k[a]),d=r.map(k=>({x:parseFloat(k[a])||0,y:parseFloat(k[o])||0})),c=r.map(k=>parseFloat(k[o])||0),g=n?[{label:`${o} vs ${a}`,data:d,backgroundColor:l,pointRadius:6,pointHoverRadius:8,pointHoverBackgroundColor:"#fff",borderColor:l}]:[{label:`${o} vs ${a}`,data:c,backgroundColor:p.includes(t)?gt(r.length):l,borderColor:l,borderWidth:2,hoverBackgroundColor:"#ffffff"}],u={labels:n?void 0:m,datasets:g},y={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#374151"}},tooltip:{backgroundColor:"#1f2937",titleColor:"#fff",bodyColor:"#fff",borderColor:"#e5e7eb",borderWidth:1}},scales:n?{x:{title:{display:!0,text:a,color:"#6b7280"},grid:{color:"#e5e7eb"}},y:{title:{display:!0,text:o,color:"#6b7280"},grid:{color:"#e5e7eb"}}}:{}};return e.jsxs("div",{className:"relative group p-5 bg-white/70 dark:bg-gray-800/60 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 border border-gray-100 dark:border-gray-700 backdrop-blur-md",children:[e.jsxs("div",{className:"absolute top-3 right-4 text-sm font-medium text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-all",children:[t.toUpperCase()," Chart"]}),e.jsx("div",{className:"h-[350px] w-full",children:e.jsx(x,{ref:s,data:u,options:y})}),e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-400/10 to-cyan-400/10 dark:from-blue-500/10 dark:to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-all duration-500 blur-2xl"})]})};le.propTypes={chartType:v.string.isRequired,dataRows:v.array.isRequired,selectedX:v.string.isRequired,selectedY:v.string.isRequired,color:v.string.isRequired,chartRef:v.object};const O=(()=>{const t={};return(r,a)=>{if(r==null||r==="")return NaN;const o=parseFloat(r);return isNaN(o)?(t[a]||(t[a]={}),r in t[a]||(t[a][r]=Object.keys(t[a]).length),t[a][r]):o}})(),B=i.forwardRef(({chartType:t="scatter3d",dataRows:r=[],selectedX:a,selectedY:o,selectedZ:l,color:s="#3b82f6"},x)=>{const p=i.useRef(null),n=[],m=[],d=[];r.forEach(u=>{const y=O(u[a],a),k=O(u[o],o),F=O(u[l],l);!isNaN(y)&&!isNaN(k)&&!isNaN(F)&&(n.push(y),m.push(k),d.push(F))});const c=[];t==="scatter3d"||t==="line3d"?c.push({type:"scatter3d",mode:t==="line3d"?"lines+markers":"markers",x:n,y:m,z:d,marker:{size:5,color:s,opacity:.8,line:{color:"#fff",width:1}},line:t==="line3d"?{color:s,width:3}:void 0}):t==="mesh3d"&&(c.push({type:"mesh3d",x:n,y:m,z:d,color:s,opacity:.6,intensity:d}),c.push({type:"scatter3d",mode:"markers",x:n,y:m,z:d,marker:{size:3,color:"#444"}}));const g={title:{text:`${t.toUpperCase()} - 3D Chart`,font:{size:18,color:"#374151"}},paper_bgcolor:"rgba(255,255,255,0)",plot_bgcolor:"rgba(255,255,255,0)",autosize:!0,height:500,margin:{t:60,l:0,r:0,b:0},scene:{xaxis:{title:{text:a,font:{color:"#6b7280"}},gridcolor:"#e5e7eb",zerolinecolor:"#d1d5db"},yaxis:{title:{text:o,font:{color:"#6b7280"}},gridcolor:"#e5e7eb",zerolinecolor:"#d1d5db"},zaxis:{title:{text:l,font:{color:"#6b7280"}},gridcolor:"#e5e7eb",zerolinecolor:"#d1d5db"}}};return i.useImperativeHandle(x,()=>({async downloadImage(){var u;try{const y=(u=p.current)==null?void 0:u.el;return y?await te.toImage(y,{format:"png",width:900,height:600}):null}catch(y){return console.error("3D chart download failed:",y),null}}})),n.length===0||m.length===0||d.length===0?e.jsx("p",{className:"text-center text-red-500 dark:text-red-400 py-4 bg-white/70 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700 rounded-lg",children:"⚠️ No valid 3D data to display."}):e.jsxs("div",{className:"relative group bg-white/70 dark:bg-gray-800/60 backdrop-blur-lg rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-all duration-500 border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"absolute top-4 right-6 text-sm font-medium text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-all",children:t.toUpperCase()}),e.jsx(ee,{ref:p,data:c,layout:g,config:{responsive:!0,displaylogo:!1},style:{width:"100%",height:"100%"}}),e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-400/10 to-cyan-400/10 dark:from-blue-500/10 dark:to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-all duration-500 blur-2xl"})]})});B.displayName="Chart3DRenderer";B.propTypes={chartType:v.string,dataRows:v.array.isRequired,selectedX:v.string.isRequired,selectedY:v.string.isRequired,selectedZ:v.string.isRequired,color:v.string};const T=i.forwardRef(({chartType:t,dataRows:r,selectedX:a,selectedY:o,color:l},s)=>{const x=t==="box",p=t==="violin",n=t==="histogram",m=i.useRef(null);if(i.useImperativeHandle(s,()=>({async downloadImage(){var y;if(x||p){const k=(y=m.current)==null?void 0:y.el;return k?await te.toImage(k,{format:"png",height:500,width:800}):null}return null}})),r.length===0||!a||(x||p)&&!o)return e.jsxs("p",{className:"text-center text-red-500 dark:text-red-400 bg-white/60 dark:bg-gray-800/40 border border-gray-200 dark:border-gray-700 rounded-lg py-4",children:["⚠️ Please select required fields for"," ",e.jsx("span",{className:"font-semibold",children:t}),"."]});if(n){const y=r.map(L=>Number(L[a])).filter(L=>!isNaN(L)),k={labels:y.map((L,$)=>`#${$+1}`),datasets:[{label:`Histogram of ${a}`,data:y,backgroundColor:l||"#3b82f6",borderRadius:6}]},F={responsive:!0,plugins:{legend:{display:!0,labels:{color:"#6b7280"}}},scales:{x:{title:{display:!0,text:"Entries",color:"#6b7280"},grid:{color:"#e5e7eb"}},y:{title:{display:!0,text:a,color:"#6b7280"},grid:{color:"#e5e7eb"}}}};return e.jsxs("div",{className:"relative group bg-white/70 dark:bg-gray-800/60 backdrop-blur-lg border border-gray-100 dark:border-gray-700 rounded-2xl p-5 shadow-md hover:shadow-2xl transition-all duration-500",children:[e.jsx(X,{data:k,options:F}),e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-400/10 to-cyan-400/10 dark:from-blue-500/10 dark:to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-all duration-500 blur-2xl"})]})}const d=r.map(y=>y[a]),c=r.map(y=>Number(y[o])).filter(y=>!isNaN(y)),g=[{type:t,x:d,y:c,boxpoints:"all",jitter:.5,pointpos:0,marker:{color:l||"#3b82f6",opacity:.8,line:{color:"#fff",width:1}},name:`${o} by ${a}`}],u={title:{text:`${t.charAt(0).toUpperCase()+t.slice(1)} Plot`,font:{size:18,color:"#374151"}},paper_bgcolor:"rgba(255,255,255,0)",plot_bgcolor:"rgba(255,255,255,0)",margin:{t:50,l:40,r:20,b:40},xaxis:{title:{text:a||"X"},gridcolor:"#e5e7eb",zerolinecolor:"#d1d5db"},yaxis:{title:{text:o||"Y"},gridcolor:"#e5e7eb",zerolinecolor:"#d1d5db"},height:400};return e.jsxs("div",{className:"relative group bg-white/70 dark:bg-gray-800/60 backdrop-blur-lg border border-gray-100 dark:border-gray-700 rounded-2xl p-5 shadow-md hover:shadow-2xl transition-all duration-500",children:[e.jsx(ee,{ref:m,data:g,layout:u,config:{responsive:!0,displaylogo:!1},className:"w-full h-full",useResizeHandler:!0}),e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-400/10 to-cyan-400/10 dark:from-blue-500/10 dark:to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-all duration-500 blur-2xl"})]})});T.displayName="ChartHistogram";T.propTypes={chartType:v.oneOf(["histogram","box","violin"]).isRequired,dataRows:v.array.isRequired,selectedX:v.string,selectedY:v.string,color:v.string};const ut=({dataRows:t})=>{if(!Array.isArray(t)||t.length===0)return e.jsx("div",{className:"p-4 rounded-xl bg-yellow-50 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border border-yellow-200 dark:border-yellow-700 text-sm shadow-sm",children:"⚠️ No data loaded to display chart metadata."});const r=t.length,a=Object.keys(t[0]||{}).length,o=Object.keys(t[0]||{});return e.jsxs("div",{className:"mt-6 p-5 bg-white/70 dark:bg-gray-800/60 backdrop-blur-lg border border-gray-200 dark:border-gray-700 rounded-2xl shadow-md hover:shadow-xl transition-all duration-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-3 text-gray-800 dark:text-gray-100 flex items-center gap-2",children:"📊 Chart Metadata"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-gray-700 dark:text-gray-300 text-sm",children:[e.jsxs("p",{className:"bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded-lg shadow-sm",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Rows:"})," ",r]}),e.jsxs("p",{className:"bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded-lg shadow-sm",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Columns:"})," ",a]}),e.jsxs("p",{className:"sm:col-span-2 bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded-lg shadow-sm",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Column Names:"})," ",o.join(", ")]})]})]})},M={"2d":[{value:"bar",label:"Bar",icon:"/icons/bar.png"},{value:"line",label:"Line",icon:"/icons/line.png"},{value:"pie",label:"Pie",icon:"/icons/pie.png"},{value:"doughnut",label:"Doughnut",icon:"/icons/doughnut.png"},{value:"radar",label:"Radar",icon:"/icons/radar.png"},{value:"polar",label:"Polar Area",icon:"/icons/polar.png"},{value:"scatter",label:"Scatter",icon:"/icons/scatter.png"}],"3d":[{value:"scatter3d",label:"3D Scatter",icon:"/icons/3dscatter.png"},{value:"mesh3d",label:"3D Mesh",icon:"/icons/3dmesh.jpeg"},{value:"surface3d",label:"3D Surface",icon:"/icons/3dsurface.png"}],distribution:[{value:"histogram",label:"Histogram",icon:"/icons/histogram.png"},{value:"box",label:"Box Plot",icon:"/icons/box.png"},{value:"violin",label:"Violin",icon:"/icons/violin.png"}]},ht=({dataRows:t=[],columns:r=[],fileName:a="",aiSummary:o=""})=>{const{id:l}=Y(),[s,x]=i.useState("2d"),[p,n]=i.useState(M["2d"][0]),[m,d]=i.useState(""),[c,g]=i.useState(""),[u,y]=i.useState(""),[k,F]=i.useState("#3b82f6"),[L,$]=i.useState(!1),[h,S]=i.useState(!1),N=i.useRef(null),D=p.value,A=[{value:"2d",label:"2D"},{value:"3d",label:"3D"},{value:"distribution",label:"Distribution"}],I=document.documentElement.classList.contains("dark"),de=async()=>{var b,f;try{if(S(!0),(s==="3d"||s==="distribution")&&((b=N.current)!=null&&b.downloadImage)){const j=await N.current.downloadImage();j?K.saveAs(j,`${p.label}.png`):alert("Download failed: Could not generate chart image.")}else{const j=(f=N.current)==null?void 0:f.canvas;if(!j){alert("No chart available to download.");return}const E=await new Promise(R=>j.toBlob(R));K.saveAs(E,`${D}.png`)}}catch(j){console.error("Download failed:",j)}finally{S(!1)}},ie=async()=>{var b;try{S(!0);let f=null;if((s==="3d"||s==="distribution")&&((b=N.current)!=null&&b.downloadImage))f=await N.current.downloadImage();else{const E=document.getElementById("chart-container");f=(await Se(E,{useCORS:!0,backgroundColor:"#fff",scale:2,willReadFrequently:!0})).toDataURL("image/png")}const j=new Ce;if(j.text(`${D.toUpperCase()} Chart Report`,10,10),f&&j.addImage(f,"PNG",10,20,180,100),j.setFontSize(11),j.text(`X Axis: ${m||"N/A"}`,10,130),j.text(`Y Axis: ${c||"N/A"}`,10,140),s==="3d"&&j.text(`Z Axis: ${u||"N/A"}`,10,150),j.text(`Total Rows: ${t.length}`,10,160),j.text(`Chart Mode: ${s.toUpperCase()}`,10,170),o){j.setFontSize(12),j.text("AI Summary:",10,185);const E=j.splitTextToSize(o,180);let R=193;E.forEach(xe=>{R+7>j.internal.pageSize.height-10&&(j.addPage(),R=10),j.text(xe,10,R),R+=7})}j.save(`${D}-chart-report.pdf`)}catch(f){console.error("PDF generation failed:",f)}finally{S(!1)}},ce=()=>!m||s!=="distribution"&&!c&&s!=="3d"?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Please select required fields"}):s==="2d"?e.jsx(le,{chartType:D,dataRows:t,selectedX:m,selectedY:c,color:k,chartRef:N}):s==="3d"?e.jsx(B,{ref:N,chartType:D,dataRows:t,selectedX:m,selectedY:c,selectedZ:u,color:k}):s==="distribution"?e.jsx(T,{ref:N,chartType:p.value,dataRows:t,selectedX:m,selectedY:c,color:k}):e.jsx("p",{children:"Unsupported mode"}),H={control:(b,f)=>({...b,backgroundColor:I?"#1f2937":"#ffffff",color:I?"#f9fafb":"#111827",borderColor:f.isFocused?"#3b82f6":I?"#374151":"#d1d5db",boxShadow:"none","&:hover":{borderColor:"#3b82f6"}}),singleValue:b=>({...b,color:I?"#f9fafb":"#111827"}),menu:b=>({...b,backgroundColor:I?"#1f2937":"#ffffff"}),option:(b,f)=>({...b,backgroundColor:f.isSelected?"#3b82f6":f.isFocused?"rgba(59,130,246,0.2)":"transparent",color:f.isSelected?"#ffffff":I?"#f9fafb":"#111827"})},ge=()=>e.jsx(V,{options:A,value:A.find(b=>b.value===s),onChange:b=>{const f=b.value;x(f),n(M[f][0]),d(""),g(""),y("")},className:"w-52",styles:H}),me=b=>e.jsx(V,{options:M[b],value:p,onChange:f=>n(f),getOptionLabel:f=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:f.icon,alt:f.label,className:"w-5 h-5"}),e.jsx("span",{children:f.label})]}),className:"w-52",styles:H});return e.jsxs("div",{className:"p-6 space-y-6 rounded-2xl bg-white dark:bg-gray-900 shadow-md hover:shadow-lg transition-all duration-500",children:[e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Chart Category"}),ge()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Chart Type"}),me(s)]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Color"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full border shadow cursor-pointer hover:scale-105 transition-transform",style:{backgroundColor:k},onClick:()=>$(!L)}),L&&e.jsx("div",{className:"absolute z-10 mt-2 p-2 rounded-lg bg-white dark:bg-gray-800 shadow animate-fadeIn",children:e.jsx(ve,{color:k,onChangeComplete:b=>F(b.hex)})})]})]})]}),e.jsxs("div",{className:"flex justify-center gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-700 dark:text-gray-300",children:"X Axis"}),e.jsxs("select",{value:m,onChange:b=>d(b.target.value),className:"w-full px-3 py-2 rounded-md border bg-white text-gray-900 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select X"}),r.map(b=>e.jsx("option",{children:b},b))]})]}),(s!=="distribution"||D==="box"||D==="violin")&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-700 dark:text-gray-300",children:"Y Axis"}),e.jsxs("select",{value:c,onChange:b=>g(b.target.value),className:"w-full px-3 py-2 rounded-md border bg-white text-gray-900 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select Y"}),r.map(b=>e.jsx("option",{children:b},b))]})]}),s==="3d"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-700 dark:text-gray-300",children:"Z Axis"}),e.jsxs("select",{value:u,onChange:b=>y(b.target.value),className:"w-full px-3 py-2 rounded-md border bg-white text-gray-900 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select Z"}),r.map(b=>e.jsx("option",{children:b},b))]})]})]}),e.jsx("div",{id:"chart-container",className:"p-4 bg-white dark:bg-gray-800 rounded shadow",children:ce()}),e.jsxs("div",{className:"flex flex-wrap justify-evenly items-center gap-6 mt-4",children:[e.jsx(ut,{dataRows:t,columns:r}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:de,disabled:h,className:`${h?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"} text-white font-medium py-2 px-4 rounded shadow transition`,children:h?"⏳ Downloading...":"📥 Download PNG"}),e.jsx("button",{onClick:ie,disabled:h,className:`${h?"bg-gray-400":"bg-green-600 hover:bg-green-700"} text-white font-medium py-2 px-4 rounded shadow transition`,children:h?"⏳ Exporting...":"🧾 Export PDF"})]})]})]})},bt=()=>{const{id:t}=Y(),r=U(),[a,o]=i.useState(null),[l,s]=i.useState([]),[x,p]=i.useState([]),[n,m]=i.useState(""),d=JSON.parse(localStorage.getItem("user"));return i.useEffect(()=>{(async()=>{try{const g=await w.get(`/upload/${t}`),u=await w.get(`/upload/preview/${t}`);if(!(g!=null&&g.data)||!(u!=null&&u.data))throw new Error("Incomplete response from server");o(g.data),s(u.data.columns),p(u.data.rows)}catch(g){console.error("Error loading file data:",g),alert("Failed to load file data. Redirecting..."),d!=null&&d.isAdmin?r("/admin/dashboard"):r("/")}})()},[t,r,d]),e.jsxs(C.div,{className:"max-w-7xl mx-auto p-6 mt-12 space-y-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:[e.jsxs(C.div,{className:"bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-gray-800 dark:to-gray-700 shadow-xl rounded-2xl p-6 border border-gray-200 dark:border-gray-700",whileHover:{scale:1.02},transition:{type:"spring",stiffness:120},children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-slate-800 dark:text-white mb-3 flex items-center gap-3",children:[e.jsx(He,{className:"text-green-500 text-4xl"}),"Analyze:"," ",e.jsx("span",{className:"text-blue-500",children:(a==null?void 0:a.fileName)||"Loading..."})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Uploaded on:"," ",a!=null&&a.createdAt?new Date(a.createdAt).toLocaleString():"Loading..."]})]}),e.jsxs(C.div,{className:"bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-6 border border-gray-200 dark:border-gray-700",initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{delay:.2,duration:.5},whileHover:{scale:1.01},children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-4 text-slate-700 dark:text-white flex items-center gap-2",children:[e.jsx(Ve,{className:"text-pink-500"}),"Choose Visualization"]}),e.jsx(ht,{dataRows:x,columns:l,fileName:a==null?void 0:a.fileName,aiSummary:n})]}),e.jsxs(C.div,{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 shadow-xl rounded-2xl p-6 border border-gray-200 dark:border-gray-700",initial:{opacity:0,x:30},animate:{opacity:1,x:0},transition:{delay:.4,duration:.5},whileHover:{scale:1.01},children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-4 text-slate-700 dark:text-white flex items-center gap-2",children:[e.jsx(Ke,{className:"text-purple-500"}),"AI Insights"]}),e.jsx(ct,{fileId:t,onSummaryGenerated:m})]})]})},pt=()=>{const t=U(),r=Q(),a=oe(),o=lt(),[l,s]=i.useState(()=>localStorage.getItem("theme")==="dark"||localStorage.getItem("theme")===null&&window.matchMedia("(prefers-color-scheme: dark)").matches);i.useEffect(()=>{l?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[l]);const x=d=>{a?t(d):(alert("🔐 Please login to access this page."),t("/login"))},p=()=>{st(),alert("👋 You have been logged out."),t("/login")},n=d=>`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 flex items-center gap-2
    ${r.pathname===d?"bg-white/20 text-white font-semibold shadow-inner dark:bg-black/30":"text-white/80 hover:text-white hover:bg-white/10 dark:hover:bg-black/20"}`,m=()=>{a?o!=null&&o.isAdmin?t("/admin/dashboard"):t("/"):(alert("🔐 Please login to access this page."),t("/login"))};return e.jsxs("nav",{className:"bg-gradient-to-r from-blue-600 via-blue-500 to-cyan-500 dark:from-gray-800 dark:via-gray-700 dark:to-gray-600 px-8 py-4 flex justify-between items-center sticky top-0 z-50 shadow-md backdrop-blur-md transition-all duration-500",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-3 text-2xl font-bold tracking-tight text-white hover:scale-105 transition-transform duration-300",children:[e.jsx("span",{className:"text-3xl text-blue-100 dark:text-blue-300",children:"📊"}),e.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-white to-blue-200 dark:from-white/70 dark:to-blue-400",children:"Excel Analysis"})]}),e.jsxs("button",{onClick:m,className:n("/admin/dashboard"),children:[e.jsx(Je,{className:"text-lg"}),"Dashboard"]}),e.jsxs("button",{onClick:()=>t("/"),className:"px-4 py-2 rounded-lg bg-gradient-to-r from-green-400 to-green-500 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300 flex items-center gap-2 dark:from-green-500 dark:to-green-600",children:[e.jsx(ae,{className:"text-lg"}),"Upload"]}),e.jsxs("button",{onClick:()=>x("/profile"),className:n("/profile"),children:[e.jsx(Ze,{className:"text-lg"}),"Profile"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>s(!l),className:"px-3 py-2 rounded-lg bg-white/20 dark:bg-black/30 text-white text-sm font-medium hover:scale-105 transition-all duration-300 flex items-center gap-2",children:[l?e.jsx(Ge,{className:"text-lg"}):e.jsx(We,{className:"text-lg"}),l?"Light":"Dark"]}),a?e.jsxs("button",{onClick:p,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300 flex items-center gap-2 dark:from-red-600 dark:to-pink-600",children:[e.jsx(Ye,{className:"text-lg"}),"Logout"]}):e.jsxs(W,{to:"/login",className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300 flex items-center gap-2 dark:from-purple-600 dark:to-indigo-600",children:[e.jsx("span",{className:"text-lg",children:"🔑"})," Login"]})]})]})},_=({children:t})=>{const r=pe(o=>o.auth),a=Q();return r!=null&&r.token?t:e.jsx(ke,{to:"/login",state:{from:a},replace:!0})},yt=()=>{const t=U(),[r,a]=i.useState(null),[o,l]=i.useState([]),[s,x]=i.useState(!0),[p,n]=i.useState(""),m=async()=>{try{const g=await w.get("/auth/me");a(g.data)}catch{n("Failed to fetch user profile.")}},d=async()=>{try{const g=await w.get("/upload/history");l(g.data)}catch{n("Failed to fetch upload history.")}finally{x(!1)}};i.useEffect(()=>{if(!oe()){alert("Please login to access your profile."),t("/login");return}m(),d()},[]);const c=o.slice(0,5);return e.jsxs("div",{className:"max-w-4xl mx-auto mt-12 px-6 py-8 bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 shadow-xl rounded-2xl border border-gray-100 dark:border-gray-700 backdrop-blur-md transition-all duration-500",children:[e.jsx("h2",{className:"text-4xl font-extrabold mb-8 text-center text-gray-800 dark:text-white",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-500 to-cyan-400 bg-clip-text text-transparent",children:"👤 User Profile"})}),p&&e.jsx("p",{className:"text-red-500 bg-red-100 dark:bg-red-900/30 rounded-lg p-3 mb-4 text-center shadow",children:p}),r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-10",children:[e.jsxs("div",{className:"p-5 rounded-xl bg-white/80 dark:bg-gray-800/70 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700 transition-all",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"👤 Name"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:r.name})]}),e.jsxs("div",{className:"p-5 rounded-xl bg-white/80 dark:bg-gray-800/70 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700 transition-all",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"📧 Email"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 break-all",children:r.email})]}),e.jsxs("div",{className:"p-5 rounded-xl bg-white/80 dark:bg-gray-800/70 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700 transition-all",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"🔑 Role"}),e.jsx("p",{className:`inline-block mt-1 px-3 py-1 rounded-full text-sm font-semibold ${r.isAdmin?"bg-gradient-to-r from-purple-500 to-indigo-500 text-white":"bg-gradient-to-r from-green-400 to-teal-500 text-white"}`,children:r.isAdmin?"Admin":"Normal User"})]}),e.jsxs("div",{className:"p-5 rounded-xl bg-white/80 dark:bg-gray-800/70 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700 transition-all",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"📂 Files Uploaded"}),e.jsx("p",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:o.length})]})]}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-white",children:"📑 Recent Uploaded Files"}),s?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading files..."}):o.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No files uploaded yet."}):e.jsx("ul",{className:"space-y-3",children:c.map(g=>e.jsxs("li",{className:"p-3 rounded-lg bg-gray-100 dark:bg-gray-700 shadow hover:shadow-md flex justify-between items-center transition-all",children:[e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200 break-all",children:g.fileName}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(g.createdAt).toLocaleDateString()})]},g._id))})]}),e.jsxs("div",{className:"p-6 rounded-xl bg-gradient-to-br from-blue-50 via-white to-blue-100 dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 shadow-inner",children:[e.jsx("h4",{className:"font-bold text-lg mb-2 text-gray-800 dark:text-white",children:"📌 Notes & Suggestions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed",children:"You can add more insights here – such as charts, badges for achievements, or activity logs. This section can be extended for personalized recommendations or performance summaries."})]})]}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 animate-pulse",children:"Loading profile..."})]})},ft=({users:t=[]})=>{const r=async a=>{if(window.confirm("Are you sure you want to delete this user?"))try{await w.delete(`/admin/user/${a}`),window.location.reload()}catch{alert("Failed to delete user")}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mt-6 transition-colors duration-300",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-700 dark:text-gray-200 mb-4",children:"👥 Users Management"}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-800 dark:text-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Email"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Role"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Files Uploaded"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-center",children:"Action"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center text-gray-500 dark:text-gray-400 py-5",children:"No users found."})}):t.map((a,o)=>e.jsxs("tr",{className:`${o%2===0?"bg-gray-50 dark:bg-gray-900":"bg-white dark:bg-gray-800"} hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors`,children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:a.name}),e.jsx("td",{className:"px-4 py-3",children:a.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-semibold ${a.isAdmin?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"}`,children:a.isAdmin?"Admin":"User"})}),e.jsx("td",{className:"px-4 py-3",children:a.uploadCount||0}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>r(a._id),className:"px-2 py-1 rounded-lg bg-red-500 hover:bg-red-600 text-white transition-all shadow-md hover:shadow-lg",title:"Delete user",children:e.jsx(z,{icon:q,className:"h-4 w-4"})})})]},a._id))})]})})]})},kt=()=>{const[t,r]=i.useState([]),[a,o]=i.useState(""),l=async()=>{try{const n=await w.get("/admin/files");r(n.data)}catch(n){console.error("Failed to fetch files:",n)}},s=async n=>{if(window.confirm("Are you sure you want to delete this file?"))try{await w.delete(`/upload/${n}`),r(m=>m.filter(d=>d._id!==n))}catch{alert("Failed to delete file")}},x=async(n,m)=>{try{const d=await w.get(`/upload/download/${n}`,{responseType:"blob"}),c=window.URL.createObjectURL(new Blob([d.data])),g=document.createElement("a");g.href=c,g.setAttribute("download",m||"file.xlsx"),document.body.appendChild(g),g.click()}catch{alert("Download failed")}};i.useEffect(()=>{l()},[]);const p=t.filter(n=>n.fileName.toLowerCase().includes(a.toLowerCase()));return e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mt-6 transition-colors duration-300",children:[e.jsxs("div",{className:"mb-5 flex flex-wrap gap-3 items-center",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"🔍 Filter by file name:"}),e.jsx("input",{type:"text",placeholder:"Enter keyword...",value:a,onChange:n=>o(n.target.value),className:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-800 dark:text-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"File Name"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"User"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Date"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-center",children:"Actions"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center text-gray-500 dark:text-gray-400 py-5",children:"No files found."})}):p.map((n,m)=>e.jsxs("tr",{className:`${m%2===0?"bg-gray-50 dark:bg-gray-900":"bg-white dark:bg-gray-800"} hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors`,children:[e.jsx("td",{className:"px-4 py-3 break-all font-medium",children:n.fileName}),e.jsx("td",{className:"px-4 py-3",children:n.userName||"Unknown"}),e.jsxs("td",{className:"px-4 py-3",children:[new Date(n.createdAt).toLocaleDateString()," ",new Date(n.createdAt).toLocaleTimeString()]}),e.jsxs("td",{className:"px-4 py-3 flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>x(n._id,n.fileName),className:"px-2 py-1 rounded-lg bg-green-500 hover:bg-green-600 text-white transition-all shadow-md hover:shadow-lg",title:"Download",children:e.jsx(z,{icon:Ne,className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>s(n._id),className:"px-2 py-1 rounded-lg bg-red-500 hover:bg-red-600 text-white transition-all shadow-md hover:shadow-lg",title:"Delete",children:e.jsx(z,{icon:q,className:"h-4 w-4"})})]})]},n._id))})]})})]})},jt=()=>{const[t,r]=i.useState([]),[a,o]=i.useState(!0),l=async()=>{try{const s=await w.get("/admin/logs");r(s.data)}catch(s){console.error("Failed to fetch audit logs:",s)}finally{o(!1)}};return i.useEffect(()=>{l()},[]),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-6 rounded-xl shadow-md transition-colors duration-300 mt-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200 flex items-center gap-2",children:"📜 Audit Logs"}),a?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading logs..."}):t.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No audit logs found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b border-gray-300 dark:border-gray-600",children:"User"}),e.jsx("th",{className:"p-3 border-b border-gray-300 dark:border-gray-600",children:"Action"}),e.jsx("th",{className:"p-3 border-b border-gray-300 dark:border-gray-600",children:"Details"}),e.jsx("th",{className:"p-3 border-b border-gray-300 dark:border-gray-600",children:"Time"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:s.userName||"Unknown"}),e.jsx("td",{className:"p-3 border-b border-gray-200 dark:border-gray-700 font-medium",children:s.action}),e.jsx("td",{className:"p-3 border-b border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400",children:s.details}),e.jsx("td",{className:"p-3 border-b border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:new Date(s.timestamp).toLocaleString()})]},s._id))})]})})]})},wt=()=>{const[t,r]=i.useState({}),[a,o]=i.useState([]),[l,s]=i.useState(!0),[x,p]=i.useState("users"),n=U();i.useEffect(()=>{(async()=>{try{const g=await w.get("/admin/stats");r(g.data);const u=await w.get("/admin/user-uploads-count");o(u.data)}catch(g){console.error("Failed to fetch admin dashboard data:",g),n("/login")}finally{s(!1)}})()},[n]);const m={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},d={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{duration:.5}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6 transition-all duration-500",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(C.div,{initial:"hidden",animate:"visible",variants:m,className:"space-y-8",children:[e.jsxs(C.div,{variants:d,className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-3",children:[e.jsx(Qe,{className:"text-blue-600 dark:text-blue-400"}),"Admin Dashboard"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",new Date().toLocaleString()]})]}),l?e.jsx(C.div,{variants:d,className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-200 dark:bg-blue-800 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(C.div,{variants:m,className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(C.div,{variants:d,className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900 rounded-lg",children:e.jsx(J,{className:"text-blue-600 dark:text-blue-400 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:t.totalUsers})]})]})}),e.jsx(C.div,{variants:d,className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900 rounded-lg",children:e.jsx(Xe,{className:"text-green-600 dark:text-green-400 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Total Files"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:t.totalFiles})]})]})}),e.jsx(C.div,{variants:d,className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-900 rounded-lg",children:e.jsx(et,{className:"text-purple-600 dark:text-purple-400 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Total Admins"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:t.totalAdmins})]})]})})]}),e.jsx(C.div,{variants:d,children:e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex space-x-8",children:["users","files","audit"].map(c=>e.jsx("button",{onClick:()=>p(c),className:`py-4 px-1 font-medium text-sm border-b-2 transition-colors ${x===c?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[c==="users"&&e.jsx(J,{}),c==="files"&&e.jsx(ae,{}),c==="audit"&&e.jsx(tt,{}),c==="users"?"User Management":c==="files"?"File Management":"Audit Logs"]})},c))})})}),e.jsxs(C.div,{variants:d,className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[x==="users"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-gray-800 dark:text-gray-100",children:"User Management"}),e.jsx(ft,{users:a})]}),x==="files"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-gray-800 dark:text-gray-100",children:"File Management"}),e.jsx(kt,{})]}),x==="audit"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-gray-800 dark:text-gray-100",children:"Audit Logs"}),e.jsx(jt,{})]})]})]})]})})})};function Nt(){return e.jsx(je,{children:e.jsxs("div",{className:"min-h-screen bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-all duration-500",children:[e.jsx(pt,{}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs(we,{children:[e.jsx(P,{path:"/login",element:e.jsx(nt,{})}),e.jsx(P,{path:"/register",element:e.jsx(dt,{})}),e.jsx(P,{path:"/profile",element:e.jsx(_,{children:e.jsx(yt,{})})}),e.jsx(P,{path:"/",element:e.jsx(_,{children:e.jsx(it,{})})}),e.jsx(P,{path:"/analyze/:id",element:e.jsx(_,{children:e.jsx(bt,{})})}),e.jsx(P,{path:"/admin/dashboard",element:e.jsx(wt,{})})]})})]})})}const ne=G({name:"upload",initialState:{files:[]},reducers:{setUploads:(t,r)=>{t.files=r.payload}}}),{setUploads:pa}=ne.actions,vt=ne.reducer,St=fe({reducer:{auth:rt,upload:vt}});he.createRoot(document.getElementById("root")).render(e.jsx(ue.StrictMode,{children:e.jsx(ye,{store:St,children:e.jsx(Nt,{})})}));
